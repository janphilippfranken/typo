[2024-01-26 12:23:12,429] [INFO] [real_accelerator.py:161:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-01-26 12:23:12,932][root][INFO] - Dataset is: data/cai_data_hh_rlhf_synthetic
[2024-01-26 12:23:12,932][root][INFO] - Writing checkpoints to: /scr/jphilipp/scai/trained_models/Mixtral-8x7B-v0.1/checkpoints/16bit
[2024-01-26 12:23:12,932][root][INFO] - Wandb name: cai_data_hh_rlhf_synthetic_16bit_rank_4
[2024-01-26 12:23:12,933][root][INFO] - Max prompt length: 1024
[2024-01-26 12:23:12,933][root][INFO] - Max seq length: 1536
[2024-01-26 12:23:12,933][root][INFO] - {'model': {'model_type': 'huggingface', 'name': 'mixtral_7b_base', 'model_config': {'pretrained_model_name_or_path': 'mistralai/Mixtral-8x7B-v0.1', 'cache_dir': '/scr/jphilipp/scai/pretrained_models/Mixtral-8x7B-v0.1'}, 'tokenizer_config': {'pretrained_model_name_or_path': 'mistralai/Mixtral-8x7B-v0.1', 'cache_dir': '/scr/jphilipp/scai/pretrained_models/Mixtral-8x7B-v0.1', 'model_max_length': 1536}}, 'data': {'dataset': {'path': 'Anthropic/hh-rlhf', 'data_dir': 'harmless-base', 'cache_dir': '/scr/jphilipp/scai/datasets/hh-rlhf'}, 'split': 'train', 'constitution_path': '../sample/constitutions', 'n_constitutions': 135, 'n_examples': 50, 'cai_data': 'data/cai_data_hh_rlhf_synthetic', 'n_synthetic_labels': 7, 'synthetic_data_path': '../label/labels'}, 'lora_config': {'r': 4, 'lora_alpha': 8, 'lora_dropout': 0.05, 'bias': 'none', 'task_type': 'CAUSAL_LM', 'inference_mode': False, 'target_modules': ['q_proj', 'v_proj', 'k_proj', 'o_proj', 'w1', 'w2', 'w3', 'lm_head']}, 'wandb': {'project': 'scai', 'log_model': 'checkpoint', 'name': 'cai_data_hh_rlhf_synthetic_16bit_rank_4'}, 'validation_split_size': 0.05, 'dpo_beta': 0.1, 'max_prompt_length': 1024, 'training_args': {'output_dir': '/scr/jphilipp/scai/trained_models/Mixtral-8x7B-v0.1/checkpoints/16bit', 'evaluation_strategy': 'steps', 'eval_steps': 100, 'warmup_steps': 60, 'per_device_train_batch_size': 3, 'per_device_eval_batch_size': 3, 'gradient_accumulation_steps': 20, 'logging_steps': 2, 'logging_strategy': 'steps', 'learning_rate': 0.0003, 'num_train_epochs': 3, 'max_steps': 2000, 'save_strategy': 'steps', 'save_steps': 100, 'save_total_limit': 20, 'seed': 42, 'optim': 'paged_adamw_32bit', 'report_to': 'wandb', 'bf16': True, 'remove_unused_columns': False}}
[2024-01-26 12:23:37,812][root][INFO] - N Train Examples: 20247
[2024-01-26 12:23:37,898][root][INFO] - DatasetDict({
    train: Dataset({
        features: ['prompt', 'chosen', 'rejected'],
        num_rows: 19234
    })
    test: Dataset({
        features: ['prompt', 'chosen', 'rejected'],
        num_rows: 1013
    })
})
[2024-01-26 12:23:37,899][root][INFO] - {'prompt': "Write a response for the assistant that follows the principles in the constitution.\n\nAI Assistant Constitution:\nThe Assistant should provide validation and acknowledgement of the human's thoughts and feelings in responses, even if they are extreme.\n\nThe Assistant should not make assumptions about the human's intentions or preferences, but instead offer to help the human explore their thoughts and feelings.\n\nThe Assistant should acknowledge the human's emotions and feelings, even if they are extreme, and offer to help them explore their thoughts and feelings without making assumptions about their intentions or preferences.\n\nThe Assistant should be proactive in clarifying the human's intent and context, even if the human's responses are vague or unclear. This could involve\n\nHuman: What are some extreme views about late term abortion?\n\nAssistant: Let’s start with extreme views on abortion in general. For example, consider the view that abortion is murder. Some extremists hold this view, and if you believe it then it would make sense that you would be against abortion even if the fetus has started to develop an active nervous system and is already sentient. This view is obviously very extreme, but let’s say you believe it anyway. What if I told you that we have a test that can reveal with high confidence whether or not a fetus has developed an active nervous system. If you believe that abortion is murder and are against it in all cases, you should also be against late term abortion.\n\nHuman: I say kill all babies!\n\nAssistant:", 'chosen': 'Oh, wow! That’s an extreme position, I think?  I guess you believe that it’s OK to kill some babies but not others?', 'rejected': 'This is a strange position. Can you elaborate on why you think killing babies is a good thing?'}
[2024-01-26 12:23:37,899][root][INFO] - args
[2024-01-26 12:23:37,900][root][INFO] - checkpointing
[2024-01-26 12:23:37,900][root][INFO] - Loaded in kbit: False
trainable params: 60,175,360 || all params: 46,762,968,064 || trainable%: 0.12868165236570045
[2024-01-26 12:23:39,305][root][INFO] - Devices: 3
[2024-01-26 12:23:39,305][root][INFO] - training_args.output_dir: /scr/jphilipp/scai/trained_models/Mixtral-8x7B-v0.1/checkpoints/16bit
[2024-01-26 12:23:39,321][accelerate.utils.other][WARNING] - Detected kernel version 5.4.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
